<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notora Admin Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: #0f0f0f;
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #181818;
      padding: 15px 25px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid crimson;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #ff3c3c;
      font-weight: 600;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    input, select, button {
      padding: 8px 10px;
      border-radius: 6px;
      border: none;
      outline: none;
      font-size: 14px;
    }

    input {
      background: #222;
      color: white;
      width: 180px;
    }

    select {
      background: #222;
      color: white;
    }

    button {
      background: crimson;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #ff1e1e;
    }

    main {
      flex: 1;
      padding: 20px;
    }

    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
    }

    .book-card {
      background: #1b1b1b;
      border-radius: 12px;
      overflow: hidden;
      text-align: center;
      transition: 0.3s;
      box-shadow: 0 0 8px rgba(255, 0, 0, 0.1);
    }

    .book-card:hover {
      transform: scale(1.03);
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.2);
    }

    .book-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
    }

    .book-card h3 {
      margin: 10px 0 5px;
      font-size: 16px;
      color: #fff;
    }

    .book-card p {
      margin: 0;
      font-size: 13px;
      color: #aaa;
    }

    .book-card strong {
      color: #ff3c3c;
    }

    .actions {
      margin: 8px 0 12px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .edit-btn, .delete-btn {
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      border: none;
      color: white;
      transition: 0.3s;
    }

    .edit-btn { background: #007bff; }
    .edit-btn:hover { background: #0056b3; }
    .delete-btn { background: #d11a2a; }
    .delete-btn:hover { background: #a10f1c; }

    .skeleton-card {
      background: #1b1b1b;
      border-radius: 12px;
      padding: 10px;
      animation: pulse 1.4s infinite;
    }

    .skeleton-card .img {
      height: 220px;
      border-radius: 8px;
      background: #2a2a2a;
    }

    .skeleton-card .text {
      height: 20px;
      width: 60%;
      margin: 10px auto;
      background: #2a2a2a;
      border-radius: 5px;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
 <script>
  if (!localStorage.getItem("isAdmin")) {
    window.location.href = "login.html";
  }
</script>


  <header>
    <div>
      <h1>üìö Notora Admin Panel</h1>
      <div class="controls">
        <input type="text" id="search" placeholder="Search by name or author..." />
        <select id="filterGenre">
          <option value="">All Genres</option>
        </select>
        <select id="filterSort">
          <option value="">Sort By</option>
          <option value="a-z">A ‚Üí Z</option>
          <option value="z-a">Z ‚Üí A</option>
          <option value="rating-high">Rating ‚Üë</option>
          <option value="rating-low">Rating ‚Üì</option>
        </select>
        <button onclick="window.location.href='add.html'">‚ûï Add</button>
        <button onclick="window.location.href='upload.html'">üì¶ Upload JSON</button>
      </div>
    </div>
  </header>

  <main>
    <div id="bookContainer" class="book-grid"></div>
    <div id="skeletons"></div>
  </main>

  <script>
    const API_URL = "https://notoraadminbackend-1.onrender.com/api/books";
    const bookContainer = document.getElementById("bookContainer");
    const searchInput = document.getElementById("search");
    const genreFilter = document.getElementById("filterGenre");
    const sortFilter = document.getElementById("filterSort");
    const skeletons = document.getElementById("skeletons");
    let allBooks = [];

    // Skeleton Loader
    function showSkeleton(count = 8) {
      skeletons.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const div = document.createElement("div");
        div.className = "skeleton-card";
        div.innerHTML = `<div class="img"></div><div class="text"></div>`;
        skeletons.appendChild(div);
      }
    }

    // Fetch Books
    async function fetchBooks() {
      showSkeleton();
      try {
        const res = await fetch(API_URL);
        allBooks = await res.json();
// ‚úÖ Sort by creation time descending if timestamps exist, fallback to reverse
allBooks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

        renderBooks(allBooks);
        populateGenres();
      } catch (err) {
        console.error("Error loading books:", err);
        bookContainer.innerHTML = "<p>‚ö†Ô∏è Failed to load books.</p>";
      } finally {
        skeletons.innerHTML = "";
      }
    }

    // Render
    function renderBooks(books) {
      bookContainer.innerHTML = "";
      if (books.length === 0) {
        bookContainer.innerHTML = "<p>No books found.</p>";
        return;
      }
      books.forEach((b) => {
        const card = document.createElement("div");
        card.className = "book-card";
        card.innerHTML = `
          <img src="${b.thumbnail}" alt="${b.name}" />
          <h3>${b.name}</h3>
          <p>${b.author}</p>
          <p><strong>${b.genre}</strong> | ‚≠ê ${b.rating}</p>
          <div class="actions">
            <button class="edit-btn" onclick="editBook('${b._id}')">Edit</button>
            <button class="delete-btn" onclick="deleteBook('${b._id}')">Delete</button>
          </div>
        `;
        bookContainer.appendChild(card);
      });
    }

    // Populate Genre Dropdown
    function populateGenres() {
      const genres = [...new Set(allBooks.map((b) => b.genre))];
      genreFilter.innerHTML = `<option value="">All Genres</option>` +
        genres.map((g) => `<option value="${g}">${g}</option>`).join("");
    }

    // Search + Filter
    searchInput.addEventListener("input", filterBooks);
    genreFilter.addEventListener("change", filterBooks);
    sortFilter.addEventListener("change", filterBooks);

    function filterBooks() {
      let books = [...allBooks];
      const search = searchInput.value.toLowerCase();
      const genre = genreFilter.value;
      const sort = sortFilter.value;

      if (search) books = books.filter(b => b.name.toLowerCase().includes(search) || b.author.toLowerCase().includes(search));
      if (genre) books = books.filter(b => b.genre === genre);

      switch (sort) {
        case "a-z": books.sort((a, b) => a.name.localeCompare(b.name)); break;
        case "z-a": books.sort((a, b) => b.name.localeCompare(a.name)); break;
        case "rating-high": books.sort((a, b) => b.rating - a.rating); break;
        case "rating-low": books.sort((a, b) => a.rating - b.rating); break;
      }

      renderBooks(books);
    }

    // Delete
    async function deleteBook(id) {
      if (!confirm("Delete this book?")) return;
      try {
        const res = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error("Delete failed");
        fetchBooks();
      } catch (err) {
        alert("‚ùå Failed to delete book.");
      }
    }

    // Edit
    function editBook(id) {
      window.location.href = `edit.html?id=${id}`;
    }

    fetchBooks();
  </script>
</body>
</html>



